<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCrib Enterprise System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* THEME: PROFESSIONAL / TECHNICAL */
            --bg-body: #f8f9fa;
            --bg-sidebar: #0f172a; /* Dark Navy - Nghiêm túc */
            --bg-card: #ffffff;
            
            --text-main: #1e293b;
            --text-muted: #64748b;
            --text-on-dark: #e2e8f0;
            
            --border-color: #e2e8f0;
            --border-strong: #cbd5e1;
            
            /* Status Colors (Muted, not neon) */
            --accent: #2563eb;       /* Royal Blue */
            --success: #15803d;      /* Deep Green */
            --warning: #b45309;      /* Amber */
            --danger: #b91c1c;       /* Red */

            --font-sans: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace; /* Dùng cho số liệu */
        }

        /* DARK MODE OVERRIDES */
        [data-theme="dark"] {
            --bg-body: #020617;
            --bg-sidebar: #000000;
            --bg-card: #0f172a;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border-color: #1e293b;
            --border-strong: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-sans); }
        body { background-color: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; font-size: 14px; }
        
        /* UTILS */
        .hidden { display: none !important; }
        .mono { font-family: var(--font-mono); }
        .bold { font-weight: 600; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .justify-between { justify-content: space-between; }
        .gap-4 { gap: 16px; }
        .text-xs { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; color: var(--text-muted); }
        
        /* === BUTTONS & INPUTS (SQUARE & TECHNICAL) === */
        input {
            width: 100%; padding: 10px 12px;
            background: var(--bg-card); border: 1px solid var(--border-strong);
            color: var(--text-main); font-size: 0.9rem;
            border-radius: 4px; /* Bo góc cực nhẹ */
            outline: none; transition: border 0.2s;
        }
        input:focus { border-color: var(--accent); }

        button {
            padding: 10px 16px; cursor: pointer; font-size: 0.85rem; font-weight: 600;
            border-radius: 4px; transition: all 0.2s;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--text-main); color: var(--bg-body); border: 1px solid var(--text-main); }
        .btn-primary:hover { opacity: 0.9; }
        .btn-outline { background: transparent; border: 1px solid var(--border-strong); color: var(--text-main); }
        .btn-outline:hover { background: var(--border-color); }
        .btn-danger { background: rgba(185, 28, 28, 0.1); color: var(--danger); border: 1px solid rgba(185, 28, 28, 0.2); }
        
        /* === AUTH SCREEN === */
        #view-auth {
            position: fixed; inset: 0; z-index: 100;
            background: var(--bg-body);
            display: flex; align-items: center; justify-content: center;
        }
        .auth-container {
            width: 400px; background: var(--bg-card);
            border: 1px solid var(--border-strong);
            padding: 40px;
            box-shadow: 0 4px 0 rgba(0,0,0,0.05); /* Hard shadow, not blurry */
        }
        .auth-tab {
            display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 24px;
        }
        .tab-btn {
            flex: 1; padding: 12px; text-align: center; cursor: pointer;
            font-weight: 600; color: var(--text-muted); border-bottom: 2px solid transparent;
        }
        .tab-btn.active { color: var(--text-main); border-bottom-color: var(--accent); }

        /* === DASHBOARD LAYOUT === */
        #view-dashboard { display: none; width: 100%; height: 100%; }
        
        /* SIDEBAR */
        .sidebar {
            width: 240px; background: var(--bg-sidebar); border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; padding: 20px; flex-shrink: 0;
        }
        .app-name { color: white; font-size: 1.1rem; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 30px; }
        .nav-link {
            padding: 10px 12px; color: var(--sidebar-text); text-decoration: none;
            display: block; margin-bottom: 4px; border-radius: 4px; color: #94a3b8;
            font-weight: 500; font-size: 0.9rem;
        }
        .nav-link:hover, .nav-link.active { background: rgba(255,255,255,0.1); color: white; }
        .nav-link.active { border-left: 3px solid var(--accent); }

        /* MAIN AREA */
        .main { flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
        .header {
            padding: 16px 32px; border-bottom: 1px solid var(--border-color); background: var(--bg-card);
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .content { padding: 32px; max-width: 1400px; margin: 0 auto; width: 100%; }

        /* CARDS & WIDGETS */
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        .grid-2-1 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        
        .card {
            background: var(--bg-card); border: 1px solid var(--border-color);
            padding: 20px; border-radius: 6px; position: relative;
        }
        .card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; border-bottom: 1px solid var(--border-color); padding-bottom: 12px; }
        
        /* METRIC BIG NUMBER */
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--text-main); line-height: 1; }
        .stat-unit { font-size: 0.9rem; color: var(--text-muted); font-weight: 500; }
        
        /* BED VISUAL */
        .bed-box {
            background: var(--bg-body); border: 1px solid var(--border-color);
            aspect-ratio: 16/9; position: relative; border-radius: 4px;
        }
        .cog-marker {
            width: 20px; height: 20px; background: var(--accent);
            border: 2px solid white; border-radius: 50%;
            position: absolute; transform: translate(-50%, -50%);
            transition: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        }
        /* Grid Lines for Bed */
        .bed-grid { position: absolute; inset: 0; background-image: linear-gradient(var(--border-color) 1px, transparent 1px), linear-gradient(90deg, var(--border-color) 1px, transparent 1px); background-size: 40px 40px; opacity: 0.5; }

        /* LOGS TABLE */
        .log-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .log-table td { padding: 8px 0; border-bottom: 1px solid var(--border-color); color: var(--text-muted); }
        .log-time { font-family: var(--font-mono); width: 80px; }
        .log-msg { color: var(--text-main); }
        
        /* TOGGLES (Custom CSS Only, No images) */
        .switch-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color); }
        .switch-btn { 
            width: 36px; height: 20px; background: var(--border-strong); border-radius: 20px; 
            position: relative; cursor: pointer; transition: 0.2s; 
        }
        .switch-btn::after {
            content:''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; 
            background: white; border-radius: 50%; transition: 0.2s; 
        }
        .switch-btn.active { background: var(--success); }
        .switch-btn.active::after { left: 18px; }

    </style>
</head>
<body data-theme="light">

    <div id="view-auth">
        <div class="auth-container">
            <div style="margin-bottom: 30px;">
                <h1 style="font-size: 1.5rem; font-weight: 800;">SmartCrib Console</h1>
                <p style="color: var(--text-muted);">Secure IoT Management Portal</p>
            </div>

            <div class="auth-tab">
                <div class="tab-btn active" onclick="Auth.switchTab('login')" id="tab-login">LOG IN</div>
                <div class="tab-btn" onclick="Auth.switchTab('signup')" id="tab-signup">REGISTER</div>
            </div>

            <form id="form-login" onsubmit="Auth.handleLogin(event)">
                <div style="margin-bottom: 16px;">
                    <label class="text-xs">Operator ID / Email</label>
                    <input type="text" id="l-email" placeholder="admin@hospital.com" value="admin">
                </div>
                <div style="margin-bottom: 24px;">
                    <label class="text-xs">Password</label>
                    <input type="password" id="l-pass" placeholder="••••••••" value="123456">
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">AUTHENTICATE</button>
            </form>

            <form id="form-signup" class="hidden" onsubmit="Auth.handleSignup(event)">
                <div style="margin-bottom: 16px;">
                    <label class="text-xs">Full Name</label>
                    <input type="text" placeholder="Dr. Name">
                </div>
                <div style="margin-bottom: 16px;">
                    <label class="text-xs">Email</label>
                    <input type="email">
                </div>
                <div style="margin-bottom: 24px;">
                    <label class="text-xs">New Password</label>
                    <input type="password">
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">CREATE ACCESS</button>
            </form>

            <div id="auth-msg" style="margin-top: 20px; color: var(--danger); font-size: 0.85rem; text-align: center; opacity: 0;">Invalid Credentials</div>
        </div>
    </div>


    <div id="view-dashboard">
        
        <aside class="sidebar">
            <div class="app-name">SC // CONSOLE</div>
            
            <div style="margin-bottom: 20px;">
                <div class="text-xs" style="margin-bottom: 8px; padding-left: 12px; opacity: 0.5;">MONITORING</div>
                <a class="nav-link active">Live Dashboard</a>
                <a class="nav-link">Patient History</a>
                <a class="nav-link">Events Log</a>
            </div>

            <div style="margin-bottom: 20px;">
                <div class="text-xs" style="margin-bottom: 8px; padding-left: 12px; opacity: 0.5;">SYSTEM</div>
                <a class="nav-link">Device Config</a>
                <a class="nav-link">Network Settings</a>
                <a class="nav-link">Firmware OTA</a>
            </div>

            <div style="margin-top: auto;">
                <div style="color: white; font-weight: 600; margin-bottom: 4px;">Admin User</div>
                <div style="color: #64748b; font-size: 0.8rem;">Role: Super Admin</div>
                <button class="btn-danger" style="width: 100%; margin-top: 15px;" onclick="Auth.logout()">LOGOUT</button>
            </div>
        </aside>

        <div class="main">
            <header class="header">
                <div>
                    <h2 style="font-weight: 700; font-size: 1.25rem;">Unit 101 Monitoring</h2>
                    <span style="color: var(--success); font-weight: 600; font-size: 0.85rem;">● SYSTEM OPERATIONAL</span>
                </div>
                <div class="flex gap-4">
                    <button class="btn-outline" onclick="toggleTheme()">SWITCH THEME</button>
                    <button class="btn-primary">EXPORT DATA</button>
                </div>
            </header>

            <div class="content">
                <div class="grid-3">
                    <div class="card">
                        <div class="text-xs" style="margin-bottom: 8px;">AMBIENT TEMP</div>
                        <div><span class="stat-value mono">24.5</span> <span class="stat-unit">°C</span></div>
                    </div>
                    <div class="card">
                        <div class="text-xs" style="margin-bottom: 8px;">HUMIDITY</div>
                        <div><span class="stat-value mono">48</span> <span class="stat-unit">%</span></div>
                    </div>
                    <div class="card">
                        <div class="text-xs" style="margin-bottom: 8px;">WIFI SIGNAL</div>
                        <div style="color: var(--success);"><span class="stat-value mono">-42</span> <span class="stat-unit">dBm</span></div>
                    </div>
                </div>

                <div class="grid-2-1">
                    <div class="flex flex-col gap-4">
                        <div class="card">
                            <div class="card-head">
                                <span class="text-xs" style="color: var(--text-main);">POSITION MAPPING</span>
                                <span style="background: var(--success); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700;">OCCUPIED</span>
                            </div>
                            <div class="bed-box">
                                <div class="bed-grid"></div>
                                <div style="position: absolute; top: 10px; width: 100%; text-align: center; font-size: 0.7rem; color: var(--text-muted); font-weight: 700;">HEAD ZONE</div>
                                <div id="cogDot" class="cog-marker" style="top: 50%; left: 50%;"></div>
                            </div>
                            <div class="flex justify-between" style="margin-top: 15px;">
                                <div>Weight: <span class="mono bold" id="valWeight">--</span> kg</div>
                                <div>Posture Time: <span class="mono bold">00:14:22</span></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-head">
                                <span class="text-xs" style="color: var(--text-main);">ACTIGRAPHY (MOVEMENT)</span>
                                <span class="text-xs">LAST 1 HOUR</span>
                            </div>
                            <canvas id="actChart" style="width: 100%; height: 150px;"></canvas>
                        </div>
                    </div>

                    <div class="flex flex-col gap-4">
                        <div class="card">
                            <div class="card-head"><span class="text-xs" style="color: var(--text-main);">DEVICE CONTROL</span></div>
                            
                            <div class="switch-row">
                                <span>Fall Alert System</span>
                                <div class="switch-btn active" onclick="this.classList.toggle('active')"></div>
                            </div>
                            <div class="switch-row">
                                <span>Auto-Zero (Tare)</span>
                                <button class="btn-outline" style="padding: 4px 8px; font-size: 0.75rem;" onclick="alert('Sent CMD: TARE')">CALIBRATE</button>
                            </div>
                            <div class="switch-row">
                                <span>Night Mode LED</span>
                                <div class="switch-btn" onclick="this.classList.toggle('active')"></div>
                            </div>
                        </div>

                        <div class="card" style="flex: 1; display: flex; flex-direction: column;">
                            <div class="card-head"><span class="text-xs" style="color: var(--text-main);">SYSTEM LOGS</span></div>
                            <div style="overflow-y: auto; flex: 1; max-height: 250px;">
                                <table class="log-table" id="logTable">
                                    </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === AUTH LOGIC ===
        const Auth = {
            init() {
                if(localStorage.getItem('sc_token')) {
                    this.showDashboard();
                }
            },
            switchTab(tab) {
                document.getElementById('form-login').classList.add('hidden');
                document.getElementById('form-signup').classList.add('hidden');
                document.getElementById('tab-login').classList.remove('active');
                document.getElementById('tab-signup').classList.remove('active');

                document.getElementById(`form-${tab}`).classList.remove('hidden');
                document.getElementById(`tab-${tab}`).classList.add('active');
            },
            handleLogin(e) {
                e.preventDefault();
                const u = document.getElementById('l-email').value;
                const p = document.getElementById('l-pass').value;
                const msg = document.getElementById('auth-msg');

                // Fake check
                if(u === 'admin' && p === '123456') {
                    localStorage.setItem('sc_token', 'valid');
                    this.showDashboard();
                } else {
                    msg.style.opacity = 1;
                }
            },
            handleSignup(e) {
                e.preventDefault();
                alert("Account created! Please login.");
                this.switchTab('login');
            },
            logout() {
                localStorage.removeItem('sc_token');
                location.reload();
            },
            showDashboard() {
                document.getElementById('view-auth').style.display = 'none';
                document.getElementById('view-dashboard').style.display = 'flex'; // Flex for sidebar layout
                Dashboard.init();
            }
        };

        // === DASHBOARD LOGIC ===
        const Dashboard = {
            chartData: new Array(60).fill(5),
            
            init() {
                this.setupChart();
                this.startSim();
                this.addLog('INFO', 'Connection established (MQTT)');
                this.addLog('INFO', 'Syncing sensor data...');
            },

            setupChart() {
                const cvs = document.getElementById('actChart');
                cvs.width = cvs.offsetWidth; 
                cvs.height = cvs.offsetHeight;
                this.ctx = cvs.getContext('2d');
            },

            addLog(type, msg) {
                const table = document.getElementById('logTable');
                const row = table.insertRow(0);
                const d = new Date();
                const time = d.toTimeString().split(' ')[0];
                
                // Colorize log type
                let color = '#64748b';
                if(type === 'ALERT') color = '#ef4444';
                if(type === 'SUCCESS') color = '#10b981';

                row.innerHTML = `
                    <td class="log-time">${time}</td>
                    <td class="log-msg"><span style="color:${color}; font-weight:700; font-size:0.7rem;">${type}</span> ${msg}</td>
                `;
                
                if(table.rows.length > 20) table.deleteRow(19);
            },

            drawChart() {
                const ctx = this.ctx;
                const w = ctx.canvas.width;
                const h = ctx.canvas.height;
                const bw = w / this.chartData.length;

                ctx.clearRect(0,0,w,h);

                // Grid line
                ctx.beginPath(); ctx.moveTo(0, h*0.8); ctx.lineTo(w, h*0.8);
                ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--border-color');
                ctx.stroke();

                this.chartData.forEach((val, i) => {
                    let color = getComputedStyle(document.body).getPropertyValue('--text-muted');
                    if(val > 40) color = getComputedStyle(document.body).getPropertyValue('--warning');
                    
                    ctx.fillStyle = color;
                    const bh = (val / 100) * h;
                    ctx.fillRect(i*bw, h-bh, bw-1, bh);
                });
            },

            startSim() {
                setInterval(() => {
                    // Sim CoG
                    const t = Date.now()/1000;
                    const x = 50 + Math.sin(t)*12;
                    const y = 50 + Math.cos(t*0.7)*8;
                    document.getElementById('cogDot').style.left = x + '%';
                    document.getElementById('cogDot').style.top = y + '%';

                    // Sim Data
                    document.getElementById('valWeight').innerText = (12.4 + Math.random()*0.1).toFixed(1);
                    
                    // Sim Chart
                    const act = Math.random() > 0.85 ? Math.random()*60 : Math.random()*5;
                    this.chartData.shift(); this.chartData.push(act);
                    this.drawChart();

                    // Random Log
                    if(Math.random() > 0.99) this.addLog('SUCCESS', 'Data snapshot saved');
                    if(Math.random() > 0.995) this.addLog('ALERT', 'Motion detected');

                }, 100);
            }
        };

        // GLOBAL THEME SWITCH
        function toggleTheme() {
            const body = document.body;
            const current = body.getAttribute('data-theme');
            body.setAttribute('data-theme', current === 'light' ? 'dark' : 'light');
        }

        window.onload = () => Auth.init();
        window.onresize = () => Dashboard.setupChart();
    </script>
</body>
</html>